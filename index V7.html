<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arbeitszeit</title>
<link rel="manifest" href="manifest.json" />
<style>
  :root{
    --glass-width: min(92vw, 520px);
    --glass-radius: 16px;
    --box-min-height: 96px;
    --accent: #1e3a8a;
    --bg: rgba(255,255,255,0.65);
    --input-bg: rgba(255,255,255,0.85);
    --font: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  html,body{
    height:100%;
    margin:0;
    font-family:var(--font);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  body{
    display:flex;
    align-items:center;
    justify-content:center;
    background: url("https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1950&q=80") center/cover no-repeat fixed;
    padding:24px;
  }

  /* milchiges Panel (glass) */
  .glass{
    width:var(--glass-width);
    border-radius:var(--glass-radius);
    padding:22px;
    background: rgba(255,255,255,0.22);
    box-shadow: 0 10px 30px rgba(0,0,0,0.22);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color:#fff;
  }

  h1{
    margin:0 0 12px 0;
    font-size:1.25rem;
    text-align:center;
    color:white;
    text-shadow: 0 2px 6px rgba(0,0,0,0.45);
  }

  /* Grid für die drei Zeilen: Eingabe links, Output rechts */
  .row{
    display:flex;
    gap:12px;
    align-items:stretch;
    margin-top:12px;
  }

  /* linke Spalte (Input) und rechte Spalte (Output) gleich groß */
  .col-input, .col-output{
    flex:1 1 50%;
    min-height:var(--box-min-height);
    border-radius:12px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    text-align:center;
  }

  .col-input{
    background: var(--input-bg);
    color:#000;
    padding:12px;
  }

  .col-output{
    background: var(--bg);
    color:#000;
    padding:12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  }

  label{
    width:100%;
    text-align:center;
    font-weight:600;
    font-size:0.95rem;
    color: #0f172a;
  }

  input[type="time"],
  input[type="number"]{
    margin-top:8px;
    width:100%;
    box-sizing:border-box;
    padding:10px;
    border-radius:10px;
    border:1px solid rgba(0,0,0,0.08);
    font-size:1rem;
    font-weight:600;
    text-align:center;
    background: white;
  }

  /* Output title + value style */
  .output-title{
    font-weight:700;
    margin-bottom:6px;
    color:#0f172a;
  }

  .output-value{
    font-size:1.05rem;
    font-weight:700;
    color:#0f172a;
  }

  .note{
    margin-top:8px;
    font-size:0.85rem;
    color: rgba(15,23,42,0.8);
  }

  .error{
    margin-top:12px;
    color:#ffe2e2;
    background: rgba(179, 0, 0, 0.12);
    padding:8px 10px;
    border-radius:8px;
    text-align:center;
    font-weight:700;
    color:#fff;
  }

  /* responsive: mobile stack */
  @media (max-width:520px){
    .row{
      flex-direction:column;
    }
    .glass{
      padding:16px;
    }
    input[type="time"], input[type="number"]{ font-size:1.05rem; padding:12px; }
    .output-value{ font-size:1.1rem; }
  }
</style>
</head>
<body>

<div class="glass">
  <h1>Arbeitszeitrechner</h1>

  <!-- Zeile 1: Start + Feierabend -->
  <div class="row">
    <div class="col-input">
      <label for="startTime">Wann fängst du an?</label>
      <input id="startTime" type="time" />
      <div class="note">Regelarbeitszeit: <strong>7h 36min</strong></div>
    </div>
    <div class="col-output">
      <div class="output-title">Feierabend</div>
      <div id="feierabend" class="output-value">—</div>
    </div>
  </div>

  <!-- Zeile 2: Pause + 10 Stunden Grenze -->
  <div class="row">
    <div class="col-input">
      <label for="pause">Pausenlänge (Minuten)</label>
      <input id="pause" type="number" min="0" value="30" />
      <div class="note">Für 10-Stunden-Grenze wird automatisch 45 min verwendet.</div>
    </div>
    <div class="col-output">
      <div class="output-title">10 Stunden Grenze</div>
      <div id="tenHour" class="output-value">—</div>
    </div>
  </div>

  <!-- Zeile 3: Arbeitsende Eingabe + Überstunden -->
  <div class="row">
    <div class="col-input">
      <label for="endTime">Arbeitsende (wann willst du Feierabend?)</label>
      <input id="endTime" type="time" />
      <div class="note">Ende kann auch vor Start sein (dann wird auf nächsten Tag gerechnet)</div>
    </div>
    <div class="col-output">
      <div class="output-title">Überstunden</div>
      <div id="overtime" class="output-value">—</div>
    </div>
  </div>

  <!-- zusätzlicher Output: berechneter Arbeitsbeginn -->
  <div class="row" style="margin-top:14px;">
    <div class="col-output" style="flex:1 1 100%; min-height:auto; padding:10px;">
      <div class="output-title">Arbeitsbeginn (bei eingegebenem Ende)</div>
      <div id="calcStart" class="output-value">—</div>
    </div>
  </div>

  <div id="err" class="error" style="display:none;"></div>
</div>

<script>
/* --------------------------
   ZEIT-LOGIK / KONSTANTEN
   --------------------------
*/
const STANDARD_WORK_MIN = 7 * 60 + 36; // 7 h 36 min = 456 min
const TEN_H_PAUSE = 45; // feste Pause bei 10h
const MIN_START = 6 * 60;  // 06:00 in Minuten
const MAX_START = 20 * 60; // 20:00 in Minuten

/* DOM */
const startInput = document.getElementById('startTime');
const pauseInput = document.getElementById('pause');
const endInput = document.getElementById('endTime');

const feierabendOut = document.getElementById('feierabend');
const tenHourOut = document.getElementById('tenHour');
const overtimeOut = document.getElementById('overtime');
const calcStartOut = document.getElementById('calcStart');
const errBox = document.getElementById('err');

/* Lade gespeicherte Eingaben */
window.addEventListener('load', () => {
  if(localStorage.getItem('startTime')) startInput.value = localStorage.getItem('startTime');
  if(localStorage.getItem('pause')) pauseInput.value = localStorage.getItem('pause');
  if(localStorage.getItem('endTime')) endInput.value = localStorage.getItem('endTime');
  recalcAll();
});

/* Auto-Save & Recalc bei Eingabe */
[startInput, pauseInput, endInput].forEach(el => {
  el.addEventListener('input', () => {
    localStorage.setItem(el.id === 'pause' ? 'pause' : el.id, el.value);
    recalcAll();
  });
});

/* Hilfsfunktionen */
function hhmmToMin(hhmm){
  if(!hhmm) return null;
  const [h,m] = hhmm.split(':').map(Number);
  return h*60 + m;
}

function minToHHMM(min){
  // Rundung auf Minuten, korrekt modulo 24h
  const total = Math.round(min) % (24*60);
  const h = Math.floor(total / 60);
  const m = total % 60;
  return String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0');
}

function formatSignedDuration(min){
  // min positive -> "+HH:MM", negative -> "-HH:MM", zero -> "00:00"
  const sign = min > 0 ? '+' : (min < 0 ? '-' : '');
  const absMin = Math.abs(Math.round(min));
  const hh = Math.floor(absMin / 60);
  const mm = absMin % 60;
  return sign + String(hh).padStart(2,'0') + ':' + String(mm).padStart(2,'0');
}

/* Validierung für Startzeit */
function validStart(startMin){
  return startMin !== null && startMin >= MIN_START && startMin <= MAX_START;
}

/* Haupt-Rechnung */
function recalcAll(){
  errBox.style.display = 'none';
  errBox.textContent = '';

  // Werte lesen
  const startVal = startInput.value;
  const pauseVal = parseInt(pauseInput.value, 10);
  const endVal = endInput.value;

  const pause = (Number.isFinite(pauseVal) && pauseVal >= 0) ? pauseVal : 30;

  // Feierabend aus Start (standard work + pause)
  if(startVal){
    const startMin = hhmmToMin(startVal);
    if(!validStart(startMin)){
      showError('Startzeit muss zwischen 06:00 und 20:00 liegen.');
      clearComputed(['feierabend','tenHour','overtime','calcStart']);
      return;
    }
    const feierabendMin = startMin + STANDARD_WORK_MIN + pause;
    feierabendOut.textContent = minToHHMM(feierabendMin);
    // 10 Stunden Grenze (start + 10h + 45min)
    const tenMin = startMin + 10*60 + TEN_H_PAUSE;
    tenHourOut.textContent = minToHHMM(tenMin);
  } else {
    feierabendOut.textContent = '—';
    tenHourOut.textContent = '—';
  }

  // Wenn Arbeitsende input vorhanden -> Berechne Arbeitsbeginn (aus Endzeit),
  // Berechne Überstunden = (Arbeitszeit zwischen start and end) - STANDARD_WORK_MIN
  if(endVal){
    // Endzeit in Minuten; support wenn end < start -> treat as next day:
    const endMinRaw = hhmmToMin(endVal);
    let startMinRaw = startVal ? hhmmToMin(startVal) : null;
    let endMin = endMinRaw;

    if(startMinRaw !== null && endMin < startMinRaw){
      // Ende am nächsten Tag
      endMin += 24*60;
    }

    // Berechneter Arbeitsbeginn (aus Endzeit): end - STANDARD_WORK - pause
    const calcStartMin = endMin - STANDARD_WORK_MIN - pause;
    // Normalize to 0..1439 for display
    calcStartOut.textContent = minToHHMM(calcStartMin);

    // Wenn Start vorgegeben: berechne Überstunden aus tatsächlich gearbeiteter Zeit
    if(startVal){
      // actual worked = (end - start) - pause
      let actualWorked = endMin - startMinRaw - pause;
      // if negative (shouldn't happen) clamp to 0
      // But we allow negative to show deficit as negative overtime
      const overtimeMin = actualWorked - STANDARD_WORK_MIN;
      overtimeOut.textContent = formatSignedDuration(overtimeMin);
    } else {
      overtimeOut.textContent = '—';
    }

    // Validate computed start if you want to ensure it's within limits
    // Optionally show error if calc start outside allowed range
    if(calcStartMin < MIN_START || calcStartMin > (24*60 + MAX_START)){ // allow next-day wrap
      // show non-blocking warning but still show calcStart
      // We'll show as error but not block other outputs
      showError('Hinweis: Berechneter Arbeitsbeginn liegt außerhalb 06:00–20:00 (kann zulässig sein).');
    }

  } else {
    calcStartOut.textContent = '—';
    // If no end provided, set overtime from start->feierabend? No — keep as dash
    if(!startVal) overtimeOut.textContent = '—';
    else overtimeOut.textContent = '—';
  }
}

/* kleine helper: Fehler anzeigen */
function showError(msg){
  errBox.style.display = 'block';
  errBox.textContent = msg;
}

function clearComputed(ids){
  ids.forEach(id => {
    const el = document.getElementById(id);
    if(el) el.textContent = '—';
  });
}

/* Service Worker registration (falls vorhanden) */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').catch(()=>{ /* ignore registration errors */ });
}
</script>

</body>
</html>
