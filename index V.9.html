<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Arbeitszeit</title>

<link rel="manifest" href="manifest.json" />

<style>
  body {
    margin: 0;
    padding: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: url("https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1950&q=80") no-repeat center center/cover;
    background-attachment: fixed;
  }

  .glass {
    width: 480px;
    max-width: 95vw;
    padding: 30px 25px;
    border-radius: 18px;
    background: rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    color: #fff;
    user-select: none;
    box-sizing: border-box;
  }

  h2 {
    margin-top: 0;
    font-weight: 600;
    text-shadow: 0 2px 6px rgba(0,0,0,0.3);
    text-align: center;
    font-size: 1.8rem;
  }

  .input-output-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 18px;
    gap: 12px;
  }

  .input-group, .output-box {
    flex: 1 1 48%;
    min-height: 90px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    font-size: 16px;
    font-weight: 500;
    border-radius: 12px;
    box-sizing: border-box;
  }

  /* Zeile 2 Eingabe + Ausgabe in einer Reihe mit Überstunden rechts */
  .input-group, .output-box {
    box-sizing: border-box;
  }

  .full-width-box {
    background: rgba(255, 255, 255, 0.65);
    color: #000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    user-select: text;
    padding: 18px 15px;
    font-size: 18px;
    font-weight: 600;
    margin-top: 20px;
    border-radius: 12px;
    text-align: center;
    min-height: 80px;
  }

  .input-group {
    background: rgba(255, 255, 255, 0.7);
    color: #000;
    padding: 10px 15px;
  }

  input[type="time"],
  input[type="number"] {
    margin-top: 8px;
    border-radius: 10px;
    border: none;
    padding: 10px;
    font-size: 16px;
    outline: none;
    width: 100%;
    box-sizing: border-box;
    text-align: center;
    font-weight: 600;
  }

  .output-box {
    background: rgba(255, 255, 255, 0.65);
    color: #000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    user-select: text;
    padding: 15px;
  }

  .output-box b {
    display: block;
    margin-bottom: 8px;
    font-weight: 700;
    font-size: 17px;
  }

  label {
    font-weight: 600;
    font-size: 15px;
  }

  .error {
    margin-top: 25px;
    color: #ffb3b3;
    font-weight: bold;
    text-shadow: 0 1px 4px rgba(0,0,0,0.4);
    user-select: none;
    text-align: center;
    font-size: 16px;
  }

  @media (max-width: 480px) {
    .input-output-row {
      flex-direction: column;
      gap: 10px;
    }
    .input-group, .output-box {
      flex: 1 1 100%;
      min-height: auto;
      font-size: 18px;
    }
  }
</style>
</head>
<body>

<div class="glass">

  <h2>Arbeitszeitrechner</h2>

  <!-- Zeile 1 -->
  <div class="input-output-row">
    <div class="input-group">
      <label for="startTime">Arbeitsbeginn</label>
      <input type="time" id="startTime" />
    </div>
    <div class="output-box">
      <b>Feierabend neutral:</b>
      <span id="endTimeOutput"></span>
    </div>
  </div>

  <!-- Zeile 2 -->
  <div class="input-output-row" style="margin-top:20px;">
    <div class="input-group">
      <label for="actualEndTime">Arbeitsende tatsächlich</label>
      <input type="time" id="actualEndTime" />
    </div>
    <div class="output-box">
      <b>Überstunden:</b>
      <span id="overtimeOutput"></span>
    </div>
  </div>

  <!-- Zeile 3 -->
  <div class="input-output-row" style="margin-top:20px;">
    <div class="input-group">
      <label for="pause">Pausenlänge (Minuten)</label>
      <input type="number" id="pause" value="30" min="0" />
    </div>
    <div class="output-box">
      <b>10 Stunden Grenze:</b>
      <span id="tenHourEnd"></span>
    </div>
  </div>

  <!-- Zeile 4 -->
  <div class="input-output-row" style="margin-top:20px;">
    <div class="input-group">
      <label for="endTime">Arbeitsende (Wann willst du Feierabend machen?)</label>
      <input type="time" id="endTime" />
    </div>
    <div class="output-box">
      <b>Arbeitsbeginn (bei eingegebenem Ende):</b>
      <span id="startTimeOutput"></span>
    </div>
  </div>

  <div class="error" id="error"></div>

</div>

<script>
  const startTimeInput = document.getElementById("startTime");
  const actualEndTimeInput = document.getElementById("actualEndTime");
  const pauseInput = document.getElementById("pause");
  const endTimeInput = document.getElementById("endTime");

  const endTimeOutput = document.getElementById("endTimeOutput");
  const tenHourEndOutput = document.getElementById("tenHourEnd");
  const startTimeOutput = document.getElementById("startTimeOutput");
  const overtimeOutput = document.getElementById("overtimeOutput");
  const errorBox = document.getElementById("error");

  const minTime = 6 * 60;   // 06:00 in Minuten
  const maxTime = 20 * 60;  // 20:00 in Minuten

  const regularWorkMinutes = 7 * 60 + 36; // 7h36min

  window.onload = () => {
    if(localStorage.startTime) startTimeInput.value = localStorage.startTime;
    if(localStorage.actualEndTime) actualEndTimeInput.value = localStorage.actualEndTime;
    if(localStorage.pause) pauseInput.value = localStorage.pause;
    if(localStorage.endTime) endTimeInput.value = localStorage.endTime;
    calculateAll();
  };

  startTimeInput.addEventListener("input", () => {
    localStorage.startTime = startTimeInput.value;
    calculateAll();
  });

  actualEndTimeInput.addEventListener("input", () => {
    localStorage.actualEndTime = actualEndTimeInput.value;
    calculateAll();
  });

  pauseInput.addEventListener("input", () => {
    localStorage.pause = pauseInput.value;
    calculateAll();
  });

  endTimeInput.addEventListener("input", () => {
    localStorage.endTime = endTimeInput.value;
    calculateAll();
  });

  function calculateAll() {
    errorBox.textContent = "";
    endTimeOutput.textContent = "";
    tenHourEndOutput.textContent = "";
    startTimeOutput.textContent = "";
    overtimeOutput.textContent = "";

    let pause = parseInt(pauseInput.value);
    if(isNaN(pause) || pause < 0) pause = 30;

    const start = startTimeInput.value;
    const actualEnd = actualEndTimeInput.value;
    const desiredEnd = endTimeInput.value;

    // 1) Feierabend neutral berechnen (Arbeitsbeginn + 7:36 + Pause)
    if(start) {
      const startMin = timeToMinutes(start);
      if(startMin < minTime || startMin > maxTime) {
        errorBox.textContent = "❗ Arbeitsbeginn muss zwischen 06:00 und 20:00 Uhr liegen.";
        return;
      }
      const endNeutralMin = startMin + regularWorkMinutes + pause;
      endTimeOutput.textContent = minutesToTime(endNeutralMin);

      // 10 Stunden Grenze (Arbeitsbeginn + 10h + 45min Pause)
      const tenHourMin = startMin + (10 * 60) + 45;
      tenHourEndOutput.textContent = minutesToTime(tenHourMin);
    }

    // 2) Arbeitsbeginn berechnen (bei eingegebenem gewünschten Ende)
    if(desiredEnd) {
      const desiredEndMin = timeToMinutes(desiredEnd);
      const startMinCalc = desiredEndMin - regularWorkMinutes - pause;

      if(startMinCalc < minTime || startMinCalc > maxTime) {
        errorBox.textContent = "❗ Berechneter Arbeitsbeginn liegt außerhalb 06:00 bis 20:00 Uhr.";
        startTimeOutput.textContent = "";
      } else {
        startTimeOutput.textContent = minutesToTime(startMinCalc);
      }
    }

    // 3) Überstunden berechnen (Arbeitsende tatsächlich - Arbeitsbeginn - Pause - 7:36)
    if(start && actualEnd) {
      const startMin = timeToMinutes(start);
      let actualEndMin = timeToMinutes(actualEnd);
      let workedMinutes = actualEndMin - startMin - pause;

      // Falls über Mitternacht gearbeitet wurde
      if(workedMinutes < 0) {
        workedMinutes += 24 * 60;
      }

      const overtime = workedMinutes - regularWorkMinutes;
      const sign = overtime >= 0 ? "" : "-";
      const absOvertime = Math.abs(overtime);
      const overtimeStr = sign + minutesToTime(absOvertime);

      overtimeOutput.textContent = overtimeStr;
    }
  }

  function timeToMinutes(t) {
    const [h,m] = t.split(":").map(Number);
    return h*60 + m;
  }

  function minutesToTime(min) {
    min = Math.round(min);
    let h = Math.floor(min / 60);
    let m = min % 60;
    return (h<10 ? "0"+h : h) + ":" + (m<10 ? "0"+m : m);
  }
</script>

</body>
</html>
